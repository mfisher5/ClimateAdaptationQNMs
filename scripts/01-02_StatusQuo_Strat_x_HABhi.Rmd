---
title: "Winter Fishing Opportunity x Strategies"
author: "M Fisher"
date: "run 2023-07-27"
output: 
  html_document:
    toc: yes
    toc_float: yes
---

# Description 

This RMarkdown explores how differences in winter fishing opportunity across communities may affect the outcomes from response strategies to a **high intensity Harmful Algal Bloom.**

Differences in winter fishing opportunity are covered as:

1. Winter crab fishing has an uncertain dampening effect on winter non-crab fishing (STATUS QUO)
2. Winter crab has a certain positive effect on winter crab fishing (*and* remove the restriction that crab Total non.crab harvest -> Material wealth & security < Total crab harvest -> Material wealth & security) ("FACILITATES")
3. Winter crab has a certain negative effect on winter crab fishing ("CHOOSE ONE")
4. Winter crab has no effect on winter non-crab fishing ("NONE")

We can’t know how the behavior of every fisherman in a community will fall out among these three approaches to shifting fishing effort. But we do know that where there is variability, there will be differential outcomes. So we have to understand the relative benefits of an adaptation strategy in the face of this variation, so that we 
Can select a strategy that primarily dampens HAB impacts across community members. 


Structural changes are implemented for the following strategies:

1. Fisheries insurance

2. Disaster Relief (Spend Plan 1)

3. Disaster Relief (Spend Plan 2)

4. Supplementary Livelihoods Diversification

We don't look at the fisheries diversification strategies because these strategies already involve specific changes to winter fishing trade-offs. 




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE)

#---- libraries ----
library(here)
library(tidyverse)
library(ggplot2)
#Load XML first--dependency not included in QPress
#To install QPress: 
#   library(remotes)
#   remotes::install_github("SWotherspoon/QPress")
library(XML)
library(tcltk2)
library(gridExtra)
library(cowplot)
library(QPress)
library(igraph)

#---- custom functions ----
source(here('R','parse.constraints.SWotherspoon.R'))
source(here('R','impact.table.R'))
source(here('R','compare.models.impact.table.R'))
source(here('R','compare.baseline.impact.table.R'))
source(here('R','qnm_sensitivity.R'))
source(here('R','impact.dataframe.R'))
source(here('R','compare.models.impact.dataframe.R'))

get.score.matrix <- function(x){
  x <- x %>% mutate(model2=ifelse(grepl("---",model),"m1","m0")) %>%
    dplyr::select(variable,model2,response.num) %>% 
    pivot_wider(names_from=model2,values_from=response.num) %>%
    mutate(score=abs(m0-m1)) %>%
    mutate(score=ifelse((m0<0)| (m0==0 & m1<0), score*-1,score))
}


```
```{r}
#---- variable key ---- 
## Read in a variable key. This tells the `impact.table` function which variables to report results for, and in what order. 
myvars.cft <- read_csv(here('omf-paper-1','data','cft_variable_key.csv'), col_names=TRUE)

# add a hab variable to the key
myvars.cft <- myvars.cft %>%
  bind_rows(data.frame(variable="HAB",group="ecosystem"))

myvars.suppdiv.cft <- read_csv(here('omf-paper-1','data','cft-test-suppdiv_variable_key.csv'), col_names=TRUE) %>%
  bind_rows(data.frame(variable="HAB",group="ecosystem"))


# save a subset of the variables in a new data frame -- only well-being and capacity variables
subvars.cft <- myvars.cft %>% filter(group %in% c("well-being","well-being 2","well-being 3","capacity")) %>%
  arrange(2)

# for graphs
table.palette=c("#04BC09", "#ABF1AD","#BBBBBB", "#B0BED8","#587AB6","black")
```
```{r eval=FALSE}
#---- Towns QNM with HAB ---- 
# dia model
m.cft.habhi <- model.dia(here::here('data','dia_models','wc_crab_t2-coastal-towns_seasonal-winter-uncertain_HABhi.dia'))
m.cft.habhi <- enforce.limitation(m.cft.habhi)

# edge constraints
m.cft.habhi.constrained <- parse.constraints(c("Total non.fishing income -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Total non.fishing income -> Material wealth & security < Total non.crab harvest -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity"),m.cft.habhi)
cft.habhi.sampler <- community.ordering.sampler(m.cft.habhi.constrained)

#---- Towns QNM with HAB FACILITATES ---- 
# dia model
m.cft.cf.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_status-quo','wc_crab_t2-coastal-towns_seasonal-crab-facilitates_HABhi.dia'))
m.cft.cf.habhi <- enforce.limitation(m.cft.cf.habhi)

# edge constraints
m.cft.cf.habhi.constrained <- parse.constraints(c("Total non.fishing income -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Total non.fishing income -> Material wealth & security < Total non.crab harvest -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity"),m.cft.cf.habhi)
cft.cf.habhi.sampler <- community.ordering.sampler(m.cft.cf.habhi.constrained)


#---- Towns QNM with HAB CHOOSE ONE ---- 
# dia model
m.cft.one.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_status-quo','wc_crab_t2-coastal-towns_seasonal-winter-certain-tradeoff_HABhi.dia'))
m.cft.one.habhi <- enforce.limitation(m.cft.one.habhi)

# edge constraints
m.cft.one.habhi.constrained <- parse.constraints(c("Total non.fishing income -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Total non.fishing income -> Material wealth & security < Total non.crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity"),m.cft.one.habhi)
cft.one.habhi.sampler <- community.ordering.sampler(m.cft.one.habhi.constrained)

#---- Towns QNM with HAB NO EFFECT ---- 
# dia model
m.cft.none.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_status-quo','wc_crab_t2-coastal-towns_seasonal-no-noncrab-change_HABhi.dia'))
m.cft.none.habhi <- enforce.limitation(m.cft.none.habhi)

# edge constraints
m.cft.none.habhi.constrained <- parse.constraints(c("Total non.fishing income -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Total non.fishing income -> Material wealth & security < Total non.crab harvest -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity"),m.cft.none.habhi)
cft.none.habhi.sampler <- community.ordering.sampler(m.cft.none.habhi.constrained)


#---- Simulate a HAB ---- 
################# HAB x status quo
cft.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.cft.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=cft.habhi.sampler,
                            validators=list(press.validate(
                              m.cft.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

################# HAB x status quo facilitates
cft.cf.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.cft.cf.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=cft.cf.habhi.sampler,
                            validators=list(press.validate(
                              m.cft.cf.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)
################# HAB x status quo choose one
cft.none.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.cft.none.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=cft.none.habhi.sampler,
                            validators=list(press.validate(
                              m.cft.none.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)
################# HAB x status quo choose one
cft.one.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.cft.one.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=cft.one.habhi.sampler,
                            validators=list(press.validate(
                              m.cft.one.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)


out <- list(cft.HABhi.sim,cft.cf.HABhi.sim,cft.none.HABhi.sim, cft.one.HABhi.sim)
names(out) <- c("Uncertain Dampening","Crab Facilitates","No Effect","Certain Dampening")
saveRDS(out,here('omf-paper-1','data','HAB_sim_out','townsQNM_StatusQuo_x_HABhi_WinterFishingImp_50kSystemSimulate.rds'))
```
```{r}
#---- Status Quo Models ---- 
sqlist <- readRDS(here('omf-paper-1','data','HAB_sim_out','townsQNM_StatusQuo_x_HABhi_WinterFishingImp_50kSystemSimulate.rds'))

cft.HABhi.sim <- sqlist[[1]]
cft.cf.HABhi.sim <- sqlist[[2]]
cft.none.HABhi.sim <- sqlist[[3]]
cft.one.HABhi.sim <- sqlist[[4]]
```

## Insurance
```{r insur.sim, eval=FALSE}

## LAST RUN 7/24/2023 to simplify interactions with insurance / crab harvest and emotional & mental health


#----- Default Implementation ----
# dia model
m.insure.habhi <- model.dia(here::here('data','dia_models','strategies','wc_crab_t2-coastal-towns_seasonal_insurance-jobsat-newDefault_HABhi.dia'))
m.insure.habhi <- enforce.limitation(m.insure.habhi)

# edge constraints
m.insure.habhi.constrained <- parse.constraints(c("Total non.fishing income -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Total non.fishing income -> Material wealth & security < Total non.crab harvest -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity",
                                         "Winter crab harvest -> Total crab harvest < insurance -> Material wealth & security"),m.insure.habhi)
insure.habhi.sampler <- community.ordering.sampler(m.insure.habhi.constrained)

#---- Simulate a HAB ---- 
insure.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.insure.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=insure.habhi.sampler,
                            validators=list(press.validate(
                              m.insure.habhi,     # the qnm
                              perturb = c(`HAB`=1,
                                          `insurance`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

#----- CHOOSE ONE ----
# dia model
m.insureW1.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal_insurance-jobsat-newDefault-win1_HABhi.dia'))
m.insureW1.habhi <- enforce.limitation(m.insureW1.habhi)  

# edge constraints
m.insureW1.habhi.constrained <- parse.constraints(c("Total non.fishing income -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Total non.fishing income -> Material wealth & security < Total non.crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity",
                                         "Winter crab harvest -> Total crab harvest < insurance -> Material wealth & security"),m.insureW1.habhi)
insureW1.habhi.sampler <- community.ordering.sampler(m.insureW1.habhi.constrained)

################# simulate HAB
insureW1.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.insureW1.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=insureW1.habhi.sampler,
                            validators=list(press.validate(
                              m.insureW1.habhi,     # the qnm
                              perturb = c(`HAB`=1,
                                          `insurance`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)


#----- Crab Facilitates ----
# dia model
m.insureW2.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal_insurance-jobsat-newDefault-win2_HABhi.dia'))
m.insureW2.habhi <- enforce.limitation(m.insureW2.habhi)  

# edge constraints
m.insureW2.habhi.constrained <- parse.constraints(c("Total non.fishing income -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Total non.fishing income -> Material wealth & security < Total non.crab harvest -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity",
                                         "Winter crab harvest -> Total crab harvest < insurance -> Material wealth & security"),m.insureW2.habhi)
insureW2.habhi.sampler <- community.ordering.sampler(m.insureW2.habhi.constrained)

################# simulate HAB
insureW2.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.insureW2.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=insureW2.habhi.sampler,
                            validators=list(press.validate(
                              m.insureW2.habhi,     # the qnm
                              perturb = c(`HAB`=1,
                                          `insurance`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

#----- No Effect ----
# dia model
m.insureW3.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal_insurance-jobsat-newDefault-win3_HABhi.dia'))
m.insureW3.habhi <- enforce.limitation(m.insureW3.habhi)  

# edge constraints
m.insureW3.habhi.constrained <- parse.constraints(c("Total non.fishing income -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Total non.fishing income -> Material wealth & security < Total non.crab harvest -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity",
                                         "Winter crab harvest -> Total crab harvest < insurance -> Material wealth & security"),m.insureW3.habhi)
insureW3.habhi.sampler <- community.ordering.sampler(m.insureW3.habhi.constrained)

################# simulate HAB
insureW3.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.insureW3.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=insureW3.habhi.sampler,
                            validators=list(press.validate(
                              m.insureW3.habhi,     # the qnm
                              perturb = c(`HAB`=1,
                                          `insurance`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

out <- list(insure.HABhi.sim,insureW2.HABhi.sim,insureW3.HABhi.sim, insureW1.HABhi.sim)
names(out) <- c("Uncertain Dampening","Crab Facilitates","No Effect","Certain Dampening")
saveRDS(out,here('omf-paper-1','data','HAB_sim_out','townsQNM_Insurance_x_HABhi_WinterFishingImp_50kSystemSimulate.rds'))
```
```{r}
sqlist <- readRDS(here('omf-paper-1','data','HAB_sim_out','townsQNM_Insurance_x_HABhi_WinterFishingImp_50kSystemSimulate.rds'))

insure.HABhi.sim <- sqlist[[1]]
insure.cf.HABhi.sim <- sqlist[[2]]
insure.none.HABhi.sim <- sqlist[[3]]
insure.one.HABhi.sim <- sqlist[[4]]
```

```{r fig.height=6, fig.width=6}
insure_list <- list(insure.HABhi.sim, insure.one.HABhi.sim, insure.cf.HABhi.sim, insure.none.HABhi.sim); names(insure_list) <- c("Default Insurance","Crab Dampens","Crab Facilitates","Crab has No Effect")
compare.insure.sub <- compare.models.impact.df(sim.list=insure_list,
                                         perturb.list=list(c(`HAB`=1,`insurance`=1),
                                                           c(`HAB`=1,`insurance`=1),
                                                           c(`HAB`=1,`insurance`=1),
                                                           c(`HAB`=1,`insurance`=1)),
                                         monitor.list=list(NA,NA,NA,NA),
                                    strong_lower=0.8, weak_lower=0.6, epsilon=1.0E-5,
                                    variable.key = subvars.cft, variable.order="specific_order",plot=TRUE)
compare.insure.sub[[3]]
```

#### Notes:

*Crab Dampens: less crab = more non-crab*:

- Fishing Activity: winter non-crab fishing activity strongly increases - leading to a weak increase in total non-crab harvest and fishing activity. As with the Status Quo model, the strong negative impact of the HAB on winter crab fishing leads to an overall negative response in total crab harvest / fishing activity (despite an increase in spr/sum crab fishing participation).

- Material wealth and security shows a weak positive response from the combination of (1) an increase in non-crab harvest, and (2) an insurance pay-out that offsets or exceeds the loss from winter crab harvest. This is what I would expect! The weak positive response by Material Wealth & Security, along with the increase in total non-crab harvest, leads to equivocal responses in well-being and capacity variables except those tied most closely with crab fishing (cultural values & practices)


*Crab Facilitates: less crab = less non-crab*

- Fishing Activity: All fishing activity and harvest declines except spr/sum crab fishing (although this is not enough to outweigh losses in total crab harvest / activity from HAB impacts on the winter crab season). The insurance pay-out is only designed to offset losses from winter crab harvest, not the non-crab harvest. The insurance payout is essentially ineffective

- There are so many strong negative responses in well-being and capacity variables because the model (1) upweights winter crab harvest, and (2) takes crab and non-crab harvest / activity as equivalent inputs for all but a handful of well-being / capacity variables (identity, cultural values & practices). It may be worth changing this equivalence, or at least keeping it in mind for a discussion. Especially since this version of the model could drastically overstate the contribution of winter non-crab fisheries to the crab fishing community. Do we want to assume that non-crab fisheries are very much secondary to crab, such that most fishermen wouldn’t be fishing at all in any given year if they couldn’t fish crab?

*Crab Has No Effect*

- Fishing Activity: 




## Disaster Relief 1

```{r dr1.sim, eval=FALSE}

## LAST RUN 7/24/2023 to simplify interactions with insurance / crab harvest and emotional & mental health

#---- Model with HAB ---- 
# dia model
m.dr1.habhi <- model.dia(here::here('data','dia_models','strategies','wc_crab_t2-coastal-towns_seasonal-disaster-1_HABhi.dia'))
m.dr1.habhi <- enforce.limitation(m.dr1.habhi)

# edge constraints
m.dr1.habhi.constrained <- parse.constraints(c("Total non.crab harvest -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity",
                                         "Total crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security"),m.dr1.habhi)
dr1.habhi.sampler <- community.ordering.sampler(m.dr1.habhi.constrained)

##### Simulate a HAB
dr1.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.dr1.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=dr1.habhi.sampler,
                            validators=list(press.validate(
                              m.dr1.habhi,     # the qnm
                              perturb = c(`HAB`=1,
                                          `disaster relief (direct)`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

#---- CHOOSE ONE ----
# dia model
m.dr1.one.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-disaster-1-crab-dampens_HABhi.dia'))
m.dr1.one.habhi <- enforce.limitation(m.dr1.one.habhi)

# edge constraints
m.dr1.one.habhi.constrained <- parse.constraints(c("Non.crab fishing activity -> Identity < Crab fishing activity -> Identity",
                                         "Total crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security"),m.dr1.one.habhi)
dr1.one.habhi.sampler <- community.ordering.sampler(m.dr1.one.habhi.constrained)

##### Simulate a HAB
dr1.one.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.dr1.one.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=dr1.one.habhi.sampler,
                            validators=list(press.validate(
                              m.dr1.one.habhi,     # the qnm
                              perturb = c(`HAB`=1,
                                          `disaster relief (direct)`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

#---- FACILITATES ----
# dia model
m.dr1.cf.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-disaster-1-crab-facilitates_HABhi.dia'))
m.dr1.cf.habhi <- enforce.limitation(m.dr1.cf.habhi)

# edge constraints
m.dr1.cf.habhi.constrained <- parse.constraints(c("Total non.crab harvest -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity",
                                         "Total crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security"),m.dr1.cf.habhi)
dr1.cf.habhi.sampler <- community.ordering.sampler(m.dr1.cf.habhi.constrained)

##### Simulate a HAB
dr1.cf.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.dr1.cf.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=dr1.cf.habhi.sampler,
                            validators=list(press.validate(
                              m.dr1.cf.habhi,     # the qnm
                              perturb = c(`HAB`=1,
                                          `disaster relief (direct)`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

#---- NO EFFECT ---- 
# dia model
m.dr1.none.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-disaster-1-crab-noEffect_HABhi.dia'))
m.dr1.none.habhi <- enforce.limitation(m.dr1.none.habhi)

# edge constraints
m.dr1.none.habhi.constrained <- parse.constraints(c("Total non.crab harvest -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity",
                                         "Total crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security"),m.dr1.none.habhi)
dr1.none.habhi.sampler <- community.ordering.sampler(m.dr1.none.habhi.constrained)

##### Simulate a HAB 
dr1.none.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.dr1.none.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=dr1.none.habhi.sampler,
                            validators=list(press.validate(
                              m.dr1.none.habhi,     # the qnm
                              perturb = c(`HAB`=1,
                                          `disaster relief (direct)`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

out <- list(dr1.HABhi.sim,dr1.cf.HABhi.sim,dr1.none.HABhi.sim, dr1.one.HABhi.sim)
names(out) <- c("Uncertain Dampening","Crab Facilitates","No Effect","Certain Dampening")
saveRDS(out,here('omf-paper-1','data','HAB_sim_out','townsQNM_DisasterRelief1_x_HABhi_WinterFishingImp_50kSystemSimulate.rds'))
```
```{r}
sqlist <- readRDS(here('omf-paper-1','data','HAB_sim_out','townsQNM_DisasterRelief1_x_HABhi_WinterFishingImp_50kSystemSimulate.rds'))

dr1.HABhi.sim <- sqlist[[1]]
dr1.cf.HABhi.sim <- sqlist[[2]]
dr1.none.HABhi.sim <- sqlist[[3]]
dr1.one.HABhi.sim <- sqlist[[4]]
```


```{r  fig.height=6, fig.width=6}
dr1_list <- list(dr1.HABhi.sim, dr1.one.HABhi.sim, dr1.cf.HABhi.sim, dr1.none.HABhi.sim); names(dr1_list) <- c("Default Disaster Relief","Crab Dampens","Crab Facilitates","Crab has No Effect")
compare.dr1.sub <- compare.models.impact.df(sim.list=dr1_list,
                                         perturb.list=list(c(`HAB`=1,`disaster relief (direct)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1)),
                                         monitor.list=list(NA,NA,NA,NA),
                                    strong_lower=0.8, weak_lower=0.6, epsilon=1.0E-5,
                                    variable.key = subvars.cft, variable.order="specific_order",plot=TRUE)
compare.dr1.sub[[3]]
```




## Disaster Relief 2

```{r dr2.sim, eval=FALSE}

## LAST RUN 7/24/2023 to simplify interactions with insurance / crab harvest and emotional & mental health

#---- Model with HAB ---- 
# dia model
m.dr2.habhi <- model.dia(here::here('data','dia_models','strategies','wc_crab_t2-coastal-towns_seasonal-disaster-2_HABhi.dia'))
m.dr2.habhi <- enforce.limitation(m.dr2.habhi)

# edge constraints
m.dr2.habhi.constrained <- parse.constraints(c("Total non.crab harvest -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity",
                                         "Total crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security"),m.dr2.habhi)
dr2.habhi.sampler <- community.ordering.sampler(m.dr2.habhi.constrained)

#### Simulate a HAB 
dr2.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.dr2.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=dr2.habhi.sampler,
                            validators=list(press.validate(
                              m.dr2.habhi,     # the qnm
                              perturb = c(`HAB`=1,
                                          `disaster relief (direct)`=1,
                                          `disaster relief (invest)`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

#---- CHOOSE ONE ----
# dia model
m.dr2.one.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-disaster-2-crab-dampens_HABhi.dia'))
m.dr2.one.habhi <- enforce.limitation(m.dr2.one.habhi)

# edge constraints
m.dr2.one.habhi.constrained <- parse.constraints(c("Non.crab fishing activity -> Identity < Crab fishing activity -> Identity",
                                         "Total crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security"),m.dr2.one.habhi)
dr2.one.habhi.sampler <- community.ordering.sampler(m.dr2.one.habhi.constrained)

##### Simulate a HAB
dr2.one.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.dr2.one.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=dr2.one.habhi.sampler,
                            validators=list(press.validate(
                              m.dr2.one.habhi,     # the qnm
                              perturb = c(`HAB`=1,
                                          `disaster relief (direct)`=1,
                                          `disaster relief (invest)`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

#---- FACILITATES ----
# dia model
m.dr2.cf.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-disaster-2-crab-facilitates_HABhi.dia'))
m.dr2.cf.habhi <- enforce.limitation(m.dr2.cf.habhi)

# edge constraints
m.dr2.cf.habhi.constrained <- parse.constraints(c("Total non.crab harvest -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity",
                                         "Total crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security"),m.dr2.cf.habhi)
dr2.cf.habhi.sampler <- community.ordering.sampler(m.dr2.cf.habhi.constrained)

##### Simulate a HAB
dr2.cf.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.dr2.cf.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=dr2.cf.habhi.sampler,
                            validators=list(press.validate(
                              m.dr2.cf.habhi,     # the qnm
                              perturb = c(`HAB`=1,
                                          `disaster relief (direct)`=1,
                                          `disaster relief (invest)`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

#---- NO EFFECT ---- 
# dia model
m.dr2.none.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-disaster-2-crab-noEffect_HABhi.dia'))
m.dr2.none.habhi <- enforce.limitation(m.dr2.none.habhi)

# edge constraints
m.dr2.none.habhi.constrained <- parse.constraints(c("Total non.crab harvest -> Material wealth & security < Total crab harvest -> Material wealth & security",
                                         "Non.crab fishing activity -> Identity < Crab fishing activity -> Identity",
                                         "Total crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security",
                                         "Total non.crab harvest -> Material wealth & security < disaster relief (direct) -> Material wealth & security"),m.dr2.none.habhi)
dr2.none.habhi.sampler <- community.ordering.sampler(m.dr2.none.habhi.constrained)

##### Simulate a HAB 
dr2.none.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.dr2.none.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=dr2.none.habhi.sampler,
                            validators=list(press.validate(
                              m.dr2.none.habhi,     # the qnm
                              perturb = c(`HAB`=1,
                                          `disaster relief (direct)`=1,
                                          `disaster relief (invest)`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

out <- list(dr2.HABhi.sim,dr2.cf.HABhi.sim,dr2.none.HABhi.sim, dr2.one.HABhi.sim)
names(out) <- c("Uncertain Dampening","Crab Facilitates","No Effect","Certain Dampening")
saveRDS(out,here('omf-paper-1','data','HAB_sim_out','townsQNM_DisasterRelief2_x_HABhi_WinterFishingImp_50kSystemSimulate.rds'))
```
```{r}
sqlist <- readRDS(here('omf-paper-1','data','HAB_sim_out','townsQNM_DisasterRelief2_x_HABhi_WinterFishingImp_50kSystemSimulate.rds'))

dr2.HABhi.sim <- sqlist[[1]]
dr2.cf.HABhi.sim <- sqlist[[2]]
dr2.none.HABhi.sim <- sqlist[[3]]
dr2.one.HABhi.sim <- sqlist[[4]]
```

```{r  fig.height=6, fig.width=6}
dr2_list <- list(dr2.HABhi.sim, dr2.one.HABhi.sim, dr2.cf.HABhi.sim, dr2.none.HABhi.sim); names(dr2_list) <- c("Default Disaster Relief 2","Crab Dampens","Crab Facilitates","Crab has No Effect")
compare.dr2.sub <- compare.models.impact.df(sim.list=dr2_list,
                                         perturb.list=list(c(`HAB`=1,`disaster relief (direct)`=1,`disaster relief (invest)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1,`disaster relief (invest)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1,`disaster relief (invest)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1,`disaster relief (invest)`=1)),
                                         monitor.list=list(NA,NA,NA,NA),
                                    strong_lower=0.8, weak_lower=0.6, epsilon=1.0E-5,
                                    variable.key = subvars.cft, variable.order="specific_order",plot=TRUE)
compare.dr2.sub[[3]]
```


## Supplementary Livelihoods

This strategy has a slightly different approach to variability in winter fishing opportunities.

The default implementation is structured so that winter crab fishing has (1) an uncertain dampening effect on winter non-crab fishing, and (2) a dampening effect on non-fishing employment. Non-fishing employment and winter non-crab fishing have a two-way dampening effect.

### Without Stress
```{r eval=FALSE}
# dia model
m.sdiv.habhi <- model.dia(here::here('data','dia_models','strategies','wc_crab_t2-coastal-towns_seasonal-supplement-div_HABhi.dia'))
m.sdiv.habhi <- enforce.limitation(m.sdiv.habhi)  

# no edge constraints

################# HAB
sdiv.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.sdiv.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=community.sampler(m.sdiv.habhi, required.groups = c(0)),
                            validators=list(press.validate(
                              m.sdiv.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

```

The 2nd alternative allows spillover from winter crab fishing to go into non-fishing activity and non-crab fishing, with no trade-off between those two alternatives (a community can "have it all" in terms of non-crab income sources).
```{r eval=FALSE}

# dia model
m.sdiv.noTO.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-supplement-div-no-tradeoff_HABhi.dia'))
m.sdiv.noTO.habhi <- enforce.limitation(m.sdiv.noTO.habhi)  

# no edge constraints

################# HAB x insurance
sdiv.noTO.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.sdiv.noTO.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=community.sampler(m.sdiv.noTO.habhi, required.groups = c(0)),
                            validators=list(press.validate(
                              m.sdiv.noTO.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

```

The 2nd-4th alternatives are similar to above -- what if winter crab fishing has a certain dampening, facilitating, or no effect on winter non-crab fishing? All of these have the two-way dampening between winter non-crab and non-fishing in place. 
```{r eval=FALSE}
#---- crab dampens ---
# dia model
m.sdiv.one.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-supplement-div-crab-dampens_HABhi.dia'))
m.sdiv.one.habhi <- enforce.limitation(m.sdiv.one.habhi)  

# no edge constraints

################# HAB
sdiv.one.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.sdiv.one.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=community.sampler(m.sdiv.one.habhi, required.groups = c(0)),
                            validators=list(press.validate(
                              m.sdiv.one.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)


#---- crab facilitates ---
# dia model
m.sdiv.cf.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-supplement-div-crab-facilitates_HABhi.dia'))
m.sdiv.cf.habhi <- enforce.limitation(m.sdiv.cf.habhi)  

# no edge constraints

################# HAB
sdiv.cf.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.sdiv.cf.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=community.sampler(m.sdiv.cf.habhi, required.groups = c(0)),
                            validators=list(press.validate(
                              m.sdiv.cf.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)


#---- crab has no effect ---
# dia model
m.sdiv.none.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-supplement-div-crab-noEffect_HABhi.dia'))
m.sdiv.none.habhi <- enforce.limitation(m.sdiv.none.habhi)  

# no edge constraints

################# HAB
sdiv.none.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.sdiv.none.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=community.sampler(m.sdiv.none.habhi, required.groups = c(0)),
                            validators=list(press.validate(
                              m.sdiv.none.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)


out <- list(sdiv.HABhi.sim,sdiv.noTO.HABhi.sim,sdiv.cf.HABhi.sim,sdiv.none.HABhi.sim, sdiv.one.HABhi.sim)
names(out) <- c("Uncertain Dampening","Uncertain Dampening no TO","Crab Facilitates","No Effect","Certain Dampening")
saveRDS(out,here('omf-paper-1','data','HAB_sim_out','townsQNM_SuppDiversification_x_HABhi_WinterFishingImp_50kSystemSimulate.rds'))
```
```{r}
sqlist <- readRDS(here('omf-paper-1','data','HAB_sim_out','townsQNM_SuppDiversification_x_HABhi_WinterFishingImp_50kSystemSimulate.rds'))

sdiv.HABhi.sim <- sqlist[[1]]
sdiv.noTO.HABhi.sim <- sqlist[[2]]
sdiv.cf.HABhi.sim <- sqlist[[3]]
sdiv.none.HABhi.sim <- sqlist[[4]]
sdiv.one.HABhi.sim <- sqlist[[5]]
```

```{r fig.height=6, fig.width=6}
sdiv_list <- list(sdiv.HABhi.sim,sdiv.noTO.HABhi.sim,  sdiv.one.HABhi.sim, sdiv.cf.HABhi.sim, sdiv.none.HABhi.sim); names(sdiv_list) <- c("Default Supp Diverse","Supp Diverse no Trade-off","Crab Dampens","Crab Facilitates","Crab has No Effect")
compare.sdiv.sub <- compare.models.impact.df(sim.list=sdiv_list,
                                         perturb.list=list(c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1)),
                                         monitor.list=list(NA,NA,NA,NA,NA),
                                    strong_lower=0.8, weak_lower=0.6, epsilon=1.0E-5,
                                    variable.key = subvars.cft, variable.order="specific_order",plot=TRUE)
compare.sdiv.sub[[3]]
```


The 5th & 6th alternatives are a sidebar -- does it matter if we allow a two-way dampening relationship between winter crab and non-crab fishing? Instead of a one-way relationships where winter crab fishing dampens winter non-crab fishing. I want to evaluate this with and without the trade-off between non-crab fishing and non-fishing employment in place. 
```{r}
#---- crab dampens, no trade-off ---
# dia model
m.sdiv.oneNoTO.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-supplement-div-crab-dampens-noTO_HABhi.dia'))
m.sdiv.oneNoTO.habhi <- enforce.limitation(m.sdiv.oneNoTO.habhi)  

# no edge constraints

###### HAB
sdiv.oneNoTO.HABhi.sim <- system.simulate(n.sims=10000, # number of randomly generated matrices to keep
                            edges=m.sdiv.oneNoTO.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=community.sampler(m.sdiv.oneNoTO.habhi, required.groups = c(0)),
                            validators=list(press.validate(
                              m.sdiv.oneNoTO.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

#---- 2 way crab-non.crab dampening, no trade-off ---
# dia model
m.sdiv.one2way.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-supplement-div-with-fishdiv2_HABhi.dia'))
m.sdiv.one2way.habhi <- enforce.limitation(m.sdiv.one2way.habhi)  

# no edge constraints

######## HAB
sdiv.one2way.HABhi.sim <- system.simulate(n.sims=10000, # number of randomly generated matrices to keep
                            edges=m.sdiv.one2way.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=community.sampler(m.sdiv.one2way.habhi, required.groups = c(0)),
                            validators=list(press.validate(
                              m.sdiv.one2way.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

#---- 2 way crab-non.crab dampening, no trade-off ---
# dia model
m.sdiv.one2wayNoTO.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-supplement-div-with-fishdiv2-noTO_HABhi.dia'))
m.sdiv.one2wayNoTO.habhi <- enforce.limitation(m.sdiv.one2wayNoTO.habhi)  

# no edge constraints

######## HAB
sdiv.one2wayNoTO.HABhi.sim <- system.simulate(n.sims=10000, # number of randomly generated matrices to keep
                            edges=m.sdiv.one2wayNoTO.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=community.sampler(m.sdiv.one2wayNoTO.habhi, required.groups = c(0)),
                            validators=list(press.validate(
                              m.sdiv.one2wayNoTO.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)

```

```{r  fig.height=6, fig.width=5}
sidebar <- list(sdiv.one.HABhi.sim, sdiv.oneNoTO.HABhi.sim, sdiv.one2way.HABhi.sim, sdiv.one2wayNoTO.HABhi.sim); names(sidebar) <- c("Crab Dampens","Crab Dampens no TO","2-way Dampen","2-way Dampen, no TO")
compare.sidebar.sub <- compare.models.impact.df(sim.list=sidebar,
                                         perturb.list=list(c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1)),
                                         monitor.list=list(NA,NA,NA,NA,NA),
                                    strong_lower=0.8, weak_lower=0.6, epsilon=1.0E-5,
                                    variable.key = subvars.cft, variable.order="specific_order",plot=TRUE)
compare.sidebar.sub[[3]]
```



```{r eval=FALSE}
# to print
sidebar <- list(sdiv.one.HABhi.sim, sdiv.oneNoTO.HABhi.sim, sdiv.one2way.HABhi.sim, sdiv.one2wayNoTO.HABhi.sim); names(sidebar) <- c("Crab Dampens","Crab Dampens no TO","2-way Dampen","2-way Dampen, no TO")
compare.sidebar <- compare.models.impact.df(sim.list=sidebar,
                                         perturb.list=list(c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1)),
                                         monitor.list=list(NA,NA,NA,NA,NA),
                                    strong_lower=0.8, weak_lower=0.6, epsilon=1.0E-5,
                                    variable.key = myvars.suppdiv.cft, variable.order="specific_order",plot=TRUE)
png(here('omf-paper-1/data/HAB_sim_out/townsQNM_HAB-Strategies','HABhi_supplement-div_two-way-fishing-tradeoff_table.png'), width=500, height=800)
compare.sidebar[[3]]
dev.off()
```

### With Stress
```{r eval=FALSE}
# --- default ---
# dia model
m.sdivS.habhi <- model.dia(here::here('data','dia_models','strategies','wc_crab_t2-coastal-towns_seasonal-supplement-div-stress_HABhi.dia'))
m.sdivS.habhi <- enforce.limitation(m.sdivS.habhi)  

# no edge constraints

################# HAB x insurance
sdivS.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.sdivS.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=community.sampler(m.sdivS.habhi, required.groups = c(0)),
                            validators=list(press.validate(
                              m.sdivS.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)


#---- crab dampens ---
# dia model
m.sdivS.one.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-supplement-div-crab-dampens_HABhi.dia'))
m.sdivS.one.habhi <- enforce.limitation(m.sdivS.one.habhi)  

# no edge constraints

################# HAB
sdivS.one.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.sdivS.one.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=community.sampler(m.sdivS.one.habhi, required.groups = c(0)),
                            validators=list(press.validate(
                              m.sdivS.one.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)


#---- crab facilitates ---
# dia model
m.sdivS.cf.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-supplement-div-crab-facilitates_HABhi.dia'))
m.sdivS.cf.habhi <- enforce.limitation(m.sdivS.cf.habhi)  

# no edge constraints

################# HAB
sdivS.cf.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.sdivS.cf.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=community.sampler(m.sdivS.cf.habhi, required.groups = c(0)),
                            validators=list(press.validate(
                              m.sdivS.cf.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)


#---- crab has no effect ---
# dia model
m.sdivS.none.habhi <- model.dia(here::here('omf-paper-1','data','dia_model_strategies','wc_crab_t2-coastal-towns_seasonal-supplement-div-crab-noEffect_HABhi.dia'))
m.sdivS.none.habhi <- enforce.limitation(m.sdivS.none.habhi)  

# no edge constraints

################# HAB
sdivS.none.HABhi.sim <- system.simulate(n.sims=50000, # number of randomly generated matrices to keep
                            edges=m.sdivS.none.habhi, # the qnm
                            required.groups = c(0), # allow uncertain edges
                            sampler=community.sampler(m.sdivS.none.habhi, required.groups = c(0)),
                            validators=list(press.validate(
                              m.sdivS.none.habhi,     # the qnm
                              perturb = c(`HAB`=1), # the perturbation
                              monitor = NA))) # a list of expected outcomes that should happen in the simulation (I don't usually use this)


out <- list(sdivS.HABhi.sim, sdivS.one.HABhi.sim,sdivS.cf.HABhi.sim,sdivS.none.HABhi.sim)
names(out) <- c("Stress, Uncertain Dampening","Stress, Certain Dampening","Stress, Crab Facilitates","Stress, No Effect")
saveRDS(out,here('omf-paper-1','data','HAB_sim_out','townsQNM_SuppDiversificationStress_x_HABhi_WinterFishingImp_50kSystemSimulate.rds'))
```
```{r}
sqlist <- readRDS(here('omf-paper-1','data','HAB_sim_out','townsQNM_SuppDiversification_x_HABhi_WinterFishingImp_50kSystemSimulate.rds'))

sdivS.HABhi.sim <- sqlist[[1]]
sdivS.one.HABhi.sim <- sqlist[[2]]
sdivS.cf.HABhi.sim <- sqlist[[3]]
sdivS.none.HABhi.sim <- sqlist[[4]]
```
```{r fig.height=6, fig.width=6}
sdiv_list <- list(sdivS.HABhi.sim,sdivS.one.HABhi.sim, sdivS.cf.HABhi.sim, sdivS.none.HABhi.sim); names(sdiv_list) <- c("Default Supp Diverse","Crab Dampens","Crab Facilitates","Crab has No Effect")
compare.sdiv.sub <- compare.models.impact.df(sim.list=sdiv_list,
                                         perturb.list=list(c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1)),
                                         monitor.list=list(NA,NA,NA,NA,NA),
                                    strong_lower=0.8, weak_lower=0.6, epsilon=1.0E-5,
                                    variable.key = subvars.cft, variable.order="specific_order",plot=TRUE)
compare.sdiv.sub[[3]]
```


There are no changes in variable response with the addition of the link: `Non-fishing livelihood activity --* Emotional & mental health`. 


## Across All

Are there commonalities across strategies when we change the *uncertain* dampening relationship between winter crab and non-crab fishing to...

*Note that this uses the version of supplementary diversification that includes the effect of stress*

### Crab Dampens

a *certain* dampening relationship
```{r  fig.height=6, fig.width=8}
tmp_list <- list(cft.HABhi.sim, cft.one.HABhi.sim, insure.HABhi.sim,insure.one.HABhi.sim,
                 dr1.HABhi.sim,dr1.one.HABhi.sim,
                 dr2.HABhi.sim,dr2.one.HABhi.sim,
                 sdivS.HABhi.sim,sdivS.one.HABhi.sim); names(tmp_list) <- c("Status Quo", " ---Crab Dampens SQ",
                                                                          "Insurance Default"," ---Crab Dampens I",
                                                                          "Disaster Relief 1 Default"," ---Crab Dampens DR1",
                                                                          "Disaster Relief 2 Default"," ---Crab Dampens DR2",
                                                                          "Supp Diverse Default"," ---Crab Dampens SDIV")
compare.alt1.sub <- compare.models.impact.df(sim.list=tmp_list,
                                         perturb.list=list(c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1,`insurance`=1),
                                                           c(`HAB`=1,`insurance`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1,`disaster relief (invest)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1,`disaster relief (invest)`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1)),
                                         monitor.list=list(NA,NA,NA,NA,NA,NA,NA,NA,NA,NA),
                                    strong_lower=0.8, weak_lower=0.6, epsilon=1.0E-5,
                                    variable.key = subvars.cft, variable.order="specific_order",plot=TRUE)
compare.alt1.sub[[3]] + geom_vline(aes(xintercept=2.5), linewidth=1.5) + 
  geom_vline(aes(xintercept=4.5), linewidth=1.5) + 
  geom_vline(aes(xintercept=6.5), linewidth=1.5) + 
  geom_vline(aes(xintercept=8.5), linewidth=1.5)
```


```{r message=FALSE, warning=FALSE}
score.df <- data.frame(response=c("Negative-Strong","Negative-Weak","Equivocal","Positive-Strong","Positive-Weak","None"),response.num=c(-2,-1,0,2,1,NA))
trial <- compare.alt1.sub[[1]] %>% left_join(score.df,by="response") %>% dplyr::select(variable,response,node_to_perturb,model,response.num) %>%
   mutate(group=ifelse(grepl("Status Quo",model) | grepl("SQ",model), "SQ",
                       ifelse(grepl("Insur",model) | grepl("Dampens I",model),"Insure",
                              ifelse(grepl("Relief 1",model) | grepl("DR1",model),"DR1",
                                     ifelse(grepl("Relief 2",model) | grepl("DR2",model),"DR2",
                                            ifelse(grepl("Supp",model) | grepl("SDIV",model),"SDIV",NA))))))

trial.nested <- trial %>% group_by(group) %>% nest()
trial.nested$data.scored <- map(trial.nested$data,get.score.matrix)

trial.unnested <- trial.nested %>% unnest(cols=c(group,data.scored)) %>% dplyr::select(-data) %>%
  left_join(score.df,by=c("m0"="response.num")) %>%
  rename(Default=response) %>% rename(response=score)

trial.unnested <- left_join(trial.unnested, trial %>% dplyr::select(group,variable,node_to_perturb) %>% distinct())

plotdat <- trial.unnested %>% mutate(response=ifelse(node_to_perturb=="y","Perturbed",response)) %>%
  mutate(no_input=ifelse(is.na(response),"None",NA)) %>% filter(response != "Perturbed") %>%
  mutate(group=ifelse(group=="SQ", "Status Quo",
                      ifelse(group=="DR1","Disaster Relief 1",
                             ifelse(group=="DR2","Disaster Relief 2",
                                    ifelse(group=="Insure","Insurance",
                                           ifelse(group=="SDIV","Supp Div")))))) %>%
  filter()

var_order <- subvars.cft %>% arrange(specific_order) %>% pull(variable)
    
    plotdat$response <- factor(plotdat$response, levels=c("2","1","0","-1","-2"))
    plotdat$variable <- factor(plotdat$variable, levels=rev(var_order))
    plotdat$group <- factor(plotdat$group,levels=c("Status Quo","Insurance","Disaster Relief 1","Disaster Relief 2","Supp Div"))
```   
Since it's a little difficult to look at variable change between model pairs, lets code that change and plot it. (0 = no change, -1 = drop one level, +1 = up one level)
```{r}
with(plotdat, table(group,response))
```


#### Notes:

- Fishing Activity, Insurance & Disaster Relief: winter non-crab fishing activity strongly increases - leading to a weak increase in total non-crab harvest and fishing activity. As with the Status Quo model, the strong negative impact of the HAB on winter crab fishing leads to an overall negative response in total crab harvest / fishing activity (despite an increase in spr/sum crab fishing participation).


- Fishing Activity, Supp Diverse:

- Commonalities: If a reduction in winter crab fishing leads to an increase in winter non-crab fishing, we see less negative outcomes in the altered Status Quo model. *Even without additional adaptive strategies, winter portfolio diversification in fisheries not affected by the HAB mitigates most negative impacts from the HAB.* When the Insurance and Disaster Relief strategies are also undertaken, with direct payouts to fishermen (from an insurance company or the government), Material wealth & security and Job Satisfaction can actually be amplified after a HAB (rather than just equivocal), assuming the payouts fully cover any lost revenue from winter crab closures. Because Disaster Relief Plan 2 includes investment in shoreside infrastructure and support services, those services may also see a positive impact after a HAB. 

- Differences: Even if a reduction in winter crab fishing leads to an increase in winter non-crab fishing, Supplemental Livelihood Diversification can still lead to the amplification or generation of negative impacts from the HAB. For example, when we alter the Status Quo model, Subsistence is unaffected by the HAB. But when we prioritize supplemental livelihood diversification, this takes away from winter non-crab fishing activity (and associated take for personal use), which means that the HAB has a weak negative impact on Subsistence. This, combined with the strong negative impact to Cultural Values & Practices, means that Community learning & cooperation / Social relationships experience a weak negative impact. This can either be considered (a) a failure to mitigate the negative impacts we see in the default Status Quo, or (b) the introduction of additional negative impacts compared to the altered Status Quo. 
But compared to the number of well-being variables that are impacted are less than in the default Status Quo.

- Supplemental Diversification showed the least sensitivity to the changed relationship, but the Disaster Relief strategies saw the greatest increase in dampening ability. 





### Crab Facilitates

an amplifying relationship (more crab = more non-crab)
```{r  fig.height=6, fig.width=7}
tmp_list <- list(cft.HABhi.sim, cft.cf.HABhi.sim,
                 insure.HABhi.sim,insure.cf.HABhi.sim,
                 dr1.HABhi.sim,dr1.cf.HABhi.sim,
                 dr2.HABhi.sim,dr2.cf.HABhi.sim,
                 sdivS.HABhi.sim,sdivS.cf.HABhi.sim); names(tmp_list) <- c("Status Quo", " ---Crab Facilitates SQ",
                                                                         "Insurance Default"," ---Crab Facilitates Insure",
                                                                          "Disaster Relief 1 Default"," ---Crab Facilitates DR1",
                                                                          "Disaster Relief 2 Default"," ---Crab Facilitates DR2",
                                                                          "Supp Diverse Default"," ---Crab Facilitates SDIV")
compare.alt2.sub <- compare.models.impact.df(sim.list=tmp_list,
                                         perturb.list=list(c(`HAB`=1), c(`HAB`=1),
                                                           c(`HAB`=1,`insurance`=1),
                                                           c(`HAB`=1,`insurance`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1,`disaster relief (invest)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1,`disaster relief (invest)`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1)),
                                         monitor.list=list(NA,NA,NA,NA,NA,NA,NA,NA,NA,NA),
                                    strong_lower=0.8, weak_lower=0.6, epsilon=1.0E-5,
                                    variable.key = subvars.cft, variable.order="specific_order",plot=TRUE)
compare.alt2.sub[[3]] + geom_vline(aes(xintercept=2.5), linewidth=1.5) + 
  geom_vline(aes(xintercept=4.5), linewidth=1.5) + 
  geom_vline(aes(xintercept=6.5), linewidth=1.5) + 
  geom_vline(aes(xintercept=8.5), linewidth=1.5)
```

```{r message=FALSE, warning=FALSE}
trial <- compare.alt2.sub[[1]] %>% left_join(score.df,by="response") %>% dplyr::select(variable,response,node_to_perturb,model,response.num) %>%
   mutate(group=ifelse(grepl("Status Quo",model) | grepl("SQ",model), "SQ",
                       ifelse(grepl("Insur",model),"Insure",
                              ifelse(grepl("Relief 1",model) | grepl("DR1",model),"DR1",
                                     ifelse(grepl("Relief 2",model) | grepl("DR2",model),"DR2",
                                            ifelse(grepl("Supp",model) | grepl("SDIV",model),"SDIV",NA))))))

trial.nested <- trial %>% group_by(group) %>% nest()
trial.nested$data.scored <- map(trial.nested$data,get.score.matrix)

trial.unnested <- trial.nested %>% unnest(cols=c(group,data.scored)) %>% dplyr::select(-data) %>%
  left_join(score.df,by=c("m0"="response.num")) %>%
  rename(Default=response) %>% rename(response=score)

trial.unnested <- left_join(trial.unnested, trial %>% dplyr::select(group,variable,node_to_perturb) %>% distinct())

plotdat <- trial.unnested %>% mutate(response=ifelse(node_to_perturb=="y","Perturbed",response)) %>%
  mutate(no_input=ifelse(is.na(response),"None",NA)) %>% filter(response != "Perturbed") %>%
  mutate(group=ifelse(group=="SQ", "Status Quo",
                      ifelse(group=="DR1","Disaster Relief 1",
                             ifelse(group=="DR2","Disaster Relief 2",
                                    ifelse(group=="Insure","Insurance",
                                           ifelse(group=="SDIV","Supp Div")))))) %>%
  filter()

var_order <- subvars.cft %>% arrange(specific_order) %>% pull(variable)
    
    plotdat$response <- factor(plotdat$response, levels=c("2","1","0","-1","-2"))
    plotdat$variable <- factor(plotdat$variable, levels=rev(var_order))
    plotdat$group <- factor(plotdat$group,levels=c("Status Quo","Insurance","Disaster Relief 1","Disaster Relief 2","Supp Div"))
```   

Since it's a little difficult to look at variable change between model pairs, lets code that change and plot it. (0 = no change, -1 = drop one level, +1 = up one level)
```{r fig.height=5, fig.width=5}
ggplot(plotdat) + 
      geom_point(aes(y=variable,x=group,fill=response),pch=22,size=8,color="grey60") +
      geom_point(aes(y=variable,x=group,pch=as.factor(no_input)),size=7,color="grey60") +
      geom_text(aes(y=variable,x=group,label=response)) +
      labs(x="",y="") + 
      scale_fill_manual(name="Change",values=table.palette, drop=FALSE, na.translate=FALSE) +
      scale_shape_manual(name="",values=c(0),na.translate=FALSE) +
      scale_x_discrete(position = "top",expand = c(0.1, 0.1)) +
      theme_bw() + theme(axis.text.x=element_text(angle=45,hjust=0))
```


```{r}
with(plotdat, table(group,response))

plotdat %>% dplyr::select(group,response,variable) %>%
  mutate(variable=paste0("var-",variable)) %>%
  pivot_wider(names_from=variable,values_from=response) %>%
  pivot_longer(cols=starts_with('var'), names_to="variable",values_to="response") %>% 
  count(group,response) %>%  mutate(freq = n / sum(n)) %>% dplyr::select(-n) %>%
  pivot_wider(names_from=response, values_from=freq)
```



#### Notes

- Fishing Activity, Insurance and Disaster Relief: All fishing activity and harvest declines except spr/sum crab fishing (although this is not enough to outweigh losses in total crab harvest / activity from HAB impacts on the winter crab season). 


- Commonalities: Disaster Relief and Supplemental Livelihood Diversification partially mitigate HAB impacts on Material wealth & security compared to the altered baseline, but effects of the HAB are similar to *no* disaster relief/ diversification in the default Status Quo. Same goes for Identity under DR Spend Plan 1, and Family/Emotional & Mental Health under DR Spend Plan 2.

- Differences: When a reduction in winter crab fishing means a reduction in participation in non-crab fisheries, the insurance pay-out does *not* mitigate HAB impacts on Material wealth & security, which can mean a decline in Job Satisfaction. Fisheries insurance is essentially ineffective. Why does insurance show a different outcome than DR Spend Plan 1? || Family and Emotional & Mental Health fare "best" with DR Spend Plan 2; depending on your perspective, DR Spend Plan 2 is the only strategy for which (a) the HAB impacts aren't amplified for those two variables compared to the default Status Quo, or (b) the HAB impacts are somewhat mitigated compared to the crab facilitates Status Quo. 

- Supplemental diversification was the least sensitive to the relationship change, 
If we look only at the number of aspects of well-being that changed response when the relationship between winter crab & non-crab fishing is changed, the insurance and supplementary diversification strategies fare "best" (i.e., experienced the least extreme change in outcomes, or the least more negative outcomes).





### No Effect

no relationship 
```{r  fig.height=6, fig.width=7}
tmp_list <- list(cft.HABhi.sim, cft.none.HABhi.sim,
                 insure.HABhi.sim,insure.none.HABhi.sim,
                 dr1.HABhi.sim,dr1.none.HABhi.sim,
                 dr2.HABhi.sim,dr2.none.HABhi.sim,
                 sdivS.HABhi.sim,sdivS.none.HABhi.sim); names(tmp_list) <- c("Status Quo", " ---No Effect SQ",
                                                                           "Insurance Default"," ---No Effect Insure",
                                                                          "Disaster Relief 1 Default"," ---No Effect DR1",
                                                                          "Disaster Relief 2 Default"," ---No Effect DR2",
                                                                          "Supp Diverse Default"," ---No Effect SDIV")
compare.alt3.sub <- compare.models.impact.df(sim.list=tmp_list,
                                         perturb.list=list(c(`HAB`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1,`insurance`=1),
                                                           c(`HAB`=1,`insurance`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1,`disaster relief (invest)`=1),
                                                           c(`HAB`=1,`disaster relief (direct)`=1,`disaster relief (invest)`=1),
                                                           c(`HAB`=1),
                                                           c(`HAB`=1)),
                                         monitor.list=list(NA,NA,NA,NA,NA,NA,NA,NA,NA,NA),
                                    strong_lower=0.8, weak_lower=0.6, epsilon=1.0E-5,
                                    variable.key = subvars.cft, variable.order="specific_order",plot=TRUE)
compare.alt3.sub[[3]] + geom_vline(aes(xintercept=2.5), linewidth=1.5) + 
  geom_vline(aes(xintercept=4.5), linewidth=1.5) + 
  geom_vline(aes(xintercept=6.5), linewidth=1.5) + 
  geom_vline(aes(xintercept=8.5), linewidth=1.5)
```

```{r message=FALSE, warning=FALSE}
trial <- compare.alt3.sub[[1]] %>% left_join(score.df,by="response") %>% dplyr::select(variable,response,node_to_perturb,model,response.num) %>%
   mutate(group=ifelse(grepl("Status Quo",model) | grepl("SQ",model), "SQ",
                       ifelse(grepl("Insur",model),"Insure",
                              ifelse(grepl("Relief 1",model) | grepl("DR1",model),"DR1",
                                     ifelse(grepl("Relief 2",model) | grepl("DR2",model),"DR2",
                                            ifelse(grepl("Supp",model) | grepl("SDIV",model),"SDIV",NA))))))

trial.nested <- trial %>% group_by(group) %>% nest()
trial.nested$data.scored <- map(trial.nested$data,get.score.matrix)

trial.unnested <- trial.nested %>% unnest(cols=c(group,data.scored)) %>% dplyr::select(-data) %>%
  left_join(score.df,by=c("m0"="response.num")) %>%
  rename(Default=response) %>% rename(response=score)

trial.unnested <- left_join(trial.unnested, trial %>% dplyr::select(group,variable,node_to_perturb) %>% distinct())

plotdat <- trial.unnested %>% mutate(response=ifelse(node_to_perturb=="y","Perturbed",response)) %>%
  mutate(no_input=ifelse(is.na(response),"None",NA)) %>% filter(response != "Perturbed") %>%
  mutate(group=ifelse(group=="SQ", "Status Quo",
                      ifelse(group=="DR1","Disaster Relief 1",
                             ifelse(group=="DR2","Disaster Relief 2",
                                    ifelse(group=="Insure","Insurance",
                                           ifelse(group=="SDIV","Supp Div")))))) %>%
  filter()

var_order <- subvars.cft %>% arrange(specific_order) %>% pull(variable)
    
    plotdat$response <- factor(plotdat$response, levels=c("2","1","0","-1","-2"))
    plotdat$variable <- factor(plotdat$variable, levels=rev(var_order))
    plotdat$group <- factor(plotdat$group,levels=c("Status Quo","Insurance","Disaster Relief 1","Disaster Relief 2","Supp Div"))
```   
Since it's a little difficult to look at variable change between model pairs, lets code that change and plot it. (0 = no change, -1 = drop one level, +1 = up one level)
```{r}
with(plotdat, table(group,response))

plotdat %>% dplyr::select(group,response,variable) %>%
  mutate(variable=paste0("var-",variable)) %>%
  pivot_wider(names_from=variable,values_from=response) %>%
  pivot_longer(cols=starts_with('var'), names_to="variable",values_to="response") %>% 
  count(group,response) %>%  mutate(freq = n / sum(n)) %>% dplyr::select(-n) %>%
  pivot_wider(names_from=response, values_from=freq)
```

**Notes**

- Fishing Activity, Insurance and Disaster Relief: A decline in winter crab fishing shifts effort to the spring/summer crab fishing season, which means that non-crab fishing also declines in this part of the year. Since there is no change in winter non-crab fishing activity the total non-crab harvest goes down from the potential non-crab harvest without a HAB. The model assumes that high crab fishing effort in the spring/summer can’t totally make up for lost opportunity in the winter, although time on the water is somewhat offset, so the total crab harvest declines.

- Commonalities: Disaster  Relief and Supplemental Diversification are able to fully mitigate the effects of the HAB on Material Wealth & Security in the default and with no effect relationships, but fisheries insurance does not. This is because we've assumed that when effort spills over into the spring / summer crab fishery, the loss of fishing opportunity in other fisheries is as lucrative, or more lucrative, than the spring / summer crab fishery. If this isn't the case, the insurance would also be able to fully mitigate the effects of the HAB on Material Wealth & Security. || Negative impacts to identity, family, and emotional & mental health are (a) mitigated compared to the "no effect" Status Quo / (b) equivalent to the no-strategy "default" Status Quo, for the two Disaster Relief strategies. With additional investments in shoreside infrastructure & trust in institutions, DR Spent Plan 2 shows the same impact on negative outcomes for shoreside infrastructure & support services, Community learning & Cooperation 

- Differences: A "no effect" relationship doesn't impact the ability of the Supplemental Diversification strategy to fully mitigate HAB impacts to Job satisfaction (which is closely linked to Material Wealth & Security, but is not fully mitigated by the other strategies under the "no effect" relationship). Supplemental Diversification also shows *better mitigation* of HAB impacts to Emotional & Mental Health, Family; but an *amplification* of impacts to Identity. 

- Supplementary Diversification is the least sensitive to this change in relationship -- shows the least change in outcomes when moving from the default relationships to the No Effect relationship. Insurance  is the most sensitive.


## Major take-aways


While implementing any of these strategies, but particularly fisheries insurance and direct relief-only disaster funding, it may still be important to maintain / improve fishing diversification during the winter months. Reason: when not fishing crab means not fishing anything else, insurance was essentially ineffective and mitigated zero impacts. But when the winter non-crab fishing opportunities are strong, the HAB could weakly positively increase those two aspects of well-being! || While DR Spend Plan 1 did lessen the negative impacts to Material Wealth & Security, (a) there was still a weak negative impact, so that "crab facilitates" fishermen will experience reductions in material wealth similar to "more crab=maybe less crab" fishermen who receive no support; and (b) the slight mitigation to material wealth & security from insurance pay-outs may not have the same downstream mitigating effects on Job Satisfaction and Emotional & Mental Health that we saw the strategy have in the "more crab=maybe less crab" model

There are many interacting, non-material aspects of well-being that are contingent on fishing activity, not just harvest, and the ability to access alternative fisheries affects whether and how the different strategies mitigate HAB impacts. For example, when crab fishing facilitates other fishing activity, DR Spent Plan 2 does *not* mitigate HAB impacts on Material wealth & security, which can mean a decline in Job Satisfaction. But when the winter non-crab fishing opportunities are strong, 

Monitoring implications – when looking at the effect of harmful algal blooms and response strategies, it is important to differentiate between individual fishing opportunity and behavior. The well-being impacts of a HAB, and the positive impact of a strategy like insurance, could be differentially distributed across individuals *even if all fishermen have multi-fishery portfolios,* depending on the extent of accessibility and profitability of alternative winter fisheries; and individual decision-making.

Action Items – 
- how to maintain sustainable access to alternative winter fisheries in a way that allows flexibility and short-term effort change in response to seasonal climate impacts? flexible in-season management has been highlighted as a limitation to climate adaptation by Drakapoulos & Poe. **Flexibility can be important even when other adaptive strategies like insurance are implemented - the listed strategies are not the final fix / their use doesn't mean that changes to fishery management and access don't need to occur.**
- how to build up markets so that there is flexible demand and processing capacity for winter catch, and so that it is profitable to increase effort in non-crab alternatives?


♣








